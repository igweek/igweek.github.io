
> SQL 注入（SQL Injection，SQLi）是一种利用 Web 应用程序中输入验证漏洞的攻击方法。攻击者通过在输入字段（如登录框、搜索栏或 URL 参数）中构造恶意 SQL 语句，导致应用程序生成意外的 SQL 查询，从而获得非授权访问数据库的权限，进而获取敏感数据、篡改数据或破坏数据库。
## 1. SQL 注入的基本原理
SQL 注入攻击通过篡改应用程序原本预期的 SQL 查询，将恶意代码注入到数据库操作中。例如，在身份验证场景中，典型的 SQL 查询为：
```sql
SELECT * FROM users WHERE username = 'user' AND password = 'password';
```
攻击者可以输入 `username` 为admin`，将` password留空。此时查询将被更改为：
```sql
SELECT * FROM users WHERE username = 'admin' --' AND password = '';
```
由于 `--或者#` 为注释符，password条件被忽略，SQL 查询实际上变为：
```sql
SELECT * FROM users WHERE username = 'admin';
```
从而绕过了身份验证，直接登录admin 账户。

万能密钥：' or 1=1#

```sql
SELECT * FROM users WHERE username = '' or 1=1#'AND password = 'password';
```

## 2.SQL注入的分类
SQL注入是一种通过恶意输入的SQL代码，操控数据库执行非预期的操作或泄露信息的攻击手段。针对SQL注入的分类方式，可以从多个维度来进行详细分析。以下是按“注入位置”、“反馈结果”和“数据类型”分类的详细说明。

### 1. **根据注入位置分类**

SQL注入的攻击位置是指攻击者通过输入数据来篡改或影响SQL查询的执行位置。常见的注入位置有以下几种：

#### **GET型注入**
- **定义**：注入发生在URL中的查询字符串参数，通常通过浏览器的地址栏输入参数。
- **特点**：攻击者通过在URL中的参数传递恶意SQL代码。通常涉及HTTP GET请求，例如在查询中插入`id=1' OR '1'='1`。
- **示例**：
  ```
  http://example.com/product?id=1' OR '1'='1
  ```
- **风险**：GET型注入很容易被发现，因为恶意SQL注入直接暴露在浏览器的URL中。

#### **POST型注入**
- **定义**：注入发生在HTTP请求的主体部分，通常通过表单提交的数据。
- **特点**：攻击者通过表单字段（如登录表单、搜索框等）提交恶意SQL语句。在POST请求中，数据并不显示在URL中，相对不易被直接发现。
- **示例**：通过登录表单提交的用户名或密码字段，例如：
  ```
  username=admin' -- 
  password=anypassword
  ```
- **风险**：POST型注入相对于GET型来说，更难以通过直接查看URL发现，但依然可以通过捕获HTTP请求进行分析。

#### **HEAD型注入**
- **定义**：注入发生在HTTP请求的头部。虽然HTTP请求头通常用于传递元数据（如User-Agent、Content-Type等），但某些应用会基于头部信息构造SQL查询，从而成为攻击的入口。
- **特点**：这种类型的注入并不常见，通常出现在一些特殊的应用中，这些应用将HTTP请求头部的内容直接传递到数据库查询中。
- **示例**：通过HTTP头部信息（如User-Agent、Referer等）注入SQL代码。
- **风险**：这种类型的注入较为隐蔽，需要攻击者对请求和服务器的实现细节有较高的了解。

### 2. **根据反馈结果分类**

根据反馈的结果，SQL注入可以分为有回显（显错注入）和无回显（盲注）两种类型。

#### **有回显（显错注入）**
- **定义**：攻击者输入的SQL注入会返回数据库的错误信息或查询结果。通过错误信息，攻击者可以进一步推测数据库的结构、表名、列名等信息。
- **特点**：返回的错误信息通常会包含数据库的结构、查询语法错误等有用的信息。这类注入能直接提供对数据库的详细反馈，攻击者可以利用这些信息构造更精确的攻击。
- **示例**：攻击者输入 `id=1' AND 1=1`，如果返回的页面显示正确的查询结果，攻击者就知道SQL注入成功了。
  ```
  SQL syntax error in your query...
  ```

#### **无回显（盲注）**
- **定义**：攻击者的注入不会返回错误信息或者查询结果，数据库执行的响应对攻击者来说不可见。通常，盲注通过应用的行为差异来推断数据库的结构或数据。
- **特点**：攻击者通过观察应用的响应（如页面加载时间、显示的内容等）来推测注入是否成功。盲注通常比显错注入更难以发现，因为它不直接暴露数据库错误。
- **盲注的分类**：
  - **基于时间盲注**：攻击者通过注入SQL语句引起数据库延时（如使用`SLEEP()`函数），从而推测查询的正确性。
    - 示例：`id=1' AND IF(1=1, SLEEP(5), 0)`
  - **基于布尔值盲注**：攻击者通过注入`TRUE`或`FALSE`的判断语句，推测某个条件是否成立，从而判断数据库结构或数据。
    - 示例：`id=1' AND 1=1`（返回正常页面）与 `id=1' AND 1=2`（返回不同的页面）通过对比不同的响应，推测数据库信息。

### 3. **根据数据类型分类**

SQL注入的另一种分类方法是基于攻击数据类型的分类，主要是根据传入的参数数据类型来区分。常见的数据类型有数字型和字符型。

#### **数字型注入**
- **定义**：攻击者通过注入数字型数据来构造SQL语句。
- **特点**：攻击通常发生在期望数字型参数的地方（如ID、数量、价格等）。攻击者可以通过注入数字来操控SQL查询的逻辑。
- **示例**：在查询参数`id=1`的位置，注入数字型SQL语句。
  ```
  id=1' OR 1=1
  ```
- **风险**：数字型注入比较容易构造，且通常能够影响数据库的查询结果。

#### **字符型注入**
- **定义**：攻击者通过注入字符型数据来构造SQL语句。
- **特点**：攻击发生在期望字符型参数的地方（如用户名、密码、搜索关键词等）。字符型注入利用SQL语句的拼接，能够有效改变查询逻辑或泄露敏感信息。
- **示例**：在查询参数`username=admin`的位置，注入字符型SQL语句。
  ```
  username=admin' OR '1'='1
  password=anypassword
  ```
- **风险**：字符型注入常常通过改变查询的逻辑，导致认证绕过、数据泄露等安全问题。

---

