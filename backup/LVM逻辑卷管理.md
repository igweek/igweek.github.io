LVM å…¨ç§° **Logical Volume Managerï¼ˆé€»è¾‘å·ç®¡ç†å™¨ï¼‰**ï¼Œä¸»è¦ç”¨äºŽ Linux ç³»ç»Ÿçš„ç£ç›˜å’Œåˆ†åŒºç®¡ç†ã€‚

å®ƒçš„ä½œç”¨æ˜¯ï¼šåœ¨ç‰©ç†ç¡¬ç›˜å’Œæ–‡ä»¶ç³»ç»Ÿä¹‹é—´ï¼ŒåŠ äº†ä¸€å±‚â€œæŠ½è±¡å±‚â€ï¼Œè®©ç£ç›˜ç®¡ç†æ›´çµæ´»ã€‚

---

### åŸºæœ¬æ¦‚å¿µ

1. **PVï¼ˆPhysical Volumeï¼Œç‰©ç†å·ï¼‰**

   * å°±æ˜¯ç¡¬ç›˜åˆ†åŒºæˆ–è€…æ•´å—ç¡¬ç›˜ï¼Œç»è¿‡ `pvcreate` åˆå§‹åŒ–åŽå˜æˆ PVã€‚

2. **VGï¼ˆVolume Groupï¼Œå·ç»„ï¼‰**

   * æŠŠå¤šä¸ª PV ç»„åˆæˆä¸€ä¸ªå¤§çš„å­˜å‚¨æ± ã€‚
   * å¯ä»¥ç†è§£ä¸ºâ€œå­˜å‚¨æ± å­â€ï¼Œå®¹é‡æ˜¯æ‰€æœ‰ PV åŠ èµ·æ¥ã€‚

3. **LVï¼ˆLogical Volumeï¼Œé€»è¾‘å·ï¼‰**

   * ä»Ž VG ä¸­åˆ’åˆ†å‡ºæ¥çš„é€»è¾‘å·ï¼Œç›¸å½“äºŽä¼ ç»Ÿçš„åˆ†åŒºã€‚
   * å¯ä»¥åœ¨å…¶ä¸Šåˆ›å»ºæ–‡ä»¶ç³»ç»Ÿï¼ˆext4/xfs ç­‰ï¼‰ï¼ŒæŒ‚è½½ä½¿ç”¨ã€‚

4. **PEï¼ˆPhysical Extentï¼Œç‰©ç†åŒºåŸŸï¼‰**

   * VG é‡Œçš„æœ€å°åˆ†é…å•å…ƒï¼Œé€šå¸¸æ˜¯ 4MB æˆ– 16MBã€‚

---

### LVM çš„å¥½å¤„

* **åŠ¨æ€è°ƒæ•´å®¹é‡**ï¼šLV å¯ä»¥éšæ—¶æ‰©å®¹/ç¼©å°ï¼Œä¸åƒä¼ ç»Ÿåˆ†åŒºéœ€è¦é‡æ–°åˆ†åŒºã€‚
* **è·¨ç£ç›˜ç®¡ç†**ï¼šå¤šä¸ªç¡¬ç›˜å¯ä»¥ç»„æˆä¸€ä¸ª VGï¼Œé€»è¾‘å·å¯ä»¥è·¨è¶Šå¤šå—ç‰©ç†ç£ç›˜ã€‚
* **å¿«ç…§åŠŸèƒ½**ï¼šå¯ä»¥å¯¹ LV åˆ›å»ºå¿«ç…§ï¼Œæ–¹ä¾¿å¤‡ä»½å’Œæ¢å¤ã€‚
* **ç®€åŒ–ç®¡ç†**ï¼šæ›´å®¹æ˜“å¯¹å¤§å®¹é‡å’Œå¤šå—ç¡¬ç›˜è¿›è¡Œç»Ÿä¸€ç®¡ç†ã€‚

---

### ä¸¾ä¸ªä¾‹å­

å‡è®¾ä½ æœ‰ä¸¤å— 500GB çš„ç¡¬ç›˜ï¼š

1. æŠŠå®ƒä»¬åˆå§‹åŒ–æˆ PVã€‚
2. å†æŠŠè¿™ä¸¤ä¸ª PV åˆå¹¶æˆä¸€ä¸ª VGï¼Œæ€»å…± 1TBã€‚
3. åœ¨ VG é‡Œåˆ›å»ºä¸€ä¸ª 700GB çš„ LV ç»™æ•°æ®åº“ï¼Œä¸€ä¸ª 300GB çš„ LV ç»™æ–‡ä»¶å­˜å‚¨ã€‚
   å¦‚æžœä»¥åŽç¡¬ç›˜ä¸å¤Ÿäº†ï¼Œå†åŠ ä¸€å— 1TB ç¡¬ç›˜åˆ° VG é‡Œï¼Œå°±èƒ½æ— ç¼æ‰©å®¹ã€‚

![image.png](https://pic.myla.eu.org/file/1756786531067_image.png)
è¿™æ˜¯ä¸€ä¸ª **LVM ç»“æž„ç¤ºæ„å›¾**ï¼š

* **PV (Physical Volume)**ï¼šåº•å±‚ä¸¤å—ç¡¬ç›˜ï¼ˆå„ 500GBï¼‰ã€‚
* **VG (Volume Group)**ï¼šæŠŠä¸¤ä¸ª PV ç»„æˆä¸€ä¸ªæ€»å®¹é‡ 1TB çš„å­˜å‚¨æ± ã€‚
* **LV (Logical Volume)**ï¼šä»Ž VG ä¸­åˆ’åˆ†å‡ºä¸¤ä¸ªé€»è¾‘å·ï¼Œä¸€ä¸ªç»™æ•°æ®åº“ï¼ˆ700GBï¼‰ï¼Œä¸€ä¸ªåšæ–‡ä»¶å­˜å‚¨ï¼ˆ300GBï¼‰ã€‚

---

# ðŸ”¬ LVM å®žéªŒï¼šä»Žé›¶åˆ›å»º LVM å¹¶æŒ‚è½½ä½¿ç”¨

## å®žéªŒç›®æ ‡

* å­¦ä¼šåˆ›å»º PVï¼ˆç‰©ç†å·ï¼‰ã€VGï¼ˆå·ç»„ï¼‰ã€LVï¼ˆé€»è¾‘å·ï¼‰
* æŽŒæ¡ LV çš„æ ¼å¼åŒ–ã€æŒ‚è½½å’Œæ‰©å®¹æ–¹æ³•
* ç†Ÿæ‚‰ LVM åŠ¨æ€å­˜å‚¨ç®¡ç†

---

## å®žéªŒçŽ¯å¢ƒ

* Linux ç³»ç»Ÿï¼ˆå»ºè®® CentOS 7+/Rocky/Ubuntu 20.04+ï¼‰
* ä¸¤å—ç©ºç¡¬ç›˜ï¼ˆæ¯”å¦‚ `/dev/sdb` å’Œ `/dev/sdc`ï¼‰ï¼Œæ¯å— 1GB+ å³å¯ï¼ˆè™šæ‹Ÿæœºé‡Œæ·»åŠ ä¹Ÿè¡Œï¼‰
* root æƒé™

---

## å®žéªŒæ­¥éª¤

### 1ï¸âƒ£ æŸ¥çœ‹æ–°ç¡¬ç›˜

```bash
lsblk
```

ä½ ä¼šçœ‹åˆ°ç±»ä¼¼ï¼š

```
sda   40G  (ç³»ç»Ÿç›˜)
sdb    2G
sdc    2G
```

---

### 2ï¸âƒ£ åˆ›å»º PVï¼ˆç‰©ç†å·ï¼‰

```bash
pvcreate /dev/sdb /dev/sdc
```

éªŒè¯ï¼š

```bash
pvs
```

è¾“å‡ºï¼š

```
PV         VG   Fmt  Attr PSize   PFree
/dev/sdb        lvm2 ---  2.00g  2.00g
/dev/sdc        lvm2 ---  2.00g  2.00g
```

---

### 3ï¸âƒ£ åˆ›å»º VGï¼ˆå·ç»„ï¼‰

```bash
vgcreate myvg /dev/sdb /dev/sdc
```

æŸ¥çœ‹ï¼š

```bash
vgs
```

ç»“æžœï¼š

```
VG    #PV #LV #SN Attr   VSize  VFree
myvg   2   0   0 wz--n-  3.99g  3.99g
```

---

### 4ï¸âƒ£ åˆ›å»º LVï¼ˆé€»è¾‘å·ï¼‰

æ¯”å¦‚åˆ›å»ºä¸€ä¸ª 3G çš„é€»è¾‘å·ï¼š

```bash
lvcreate -L 3G -n mylv myvg
```

æŸ¥çœ‹ï¼š

```bash
lvs
```

è¾“å‡ºï¼š

```
LV   VG   Attr       LSize Pool Origin Data%  Meta%  Move Log Cpy%Sync Convert
mylv myvg -wi-a----- 3.00g
```

---

### 5ï¸âƒ£ æ ¼å¼åŒ–å¹¶æŒ‚è½½

```bash
mkfs.ext4 /dev/myvg/mylv
mkdir /mnt/mylvm
mount /dev/myvg/mylv /mnt/mylvm
df -h /mnt/mylvm
```

èƒ½çœ‹åˆ°ä¸€ä¸ª 3GB çš„æ–°åˆ†åŒºã€‚

---

### 6ï¸âƒ£ åŠ¨æ€æ‰©å®¹ï¼ˆä½“éªŒ LVM çš„å¼ºå¤§ï¼‰

æ¯”å¦‚å†æ‰©å®¹ 1GBï¼š

```bash
lvextend -L +1G /dev/myvg/mylv
resize2fs /dev/myvg/mylv
```

å†çœ‹ï¼š

```bash
df -h /mnt/mylvm
```

å®¹é‡å·²ç»å˜å¤§äº†ï¼

---

### 7ï¸âƒ£ å¸è½½ä¸Žåˆ é™¤ï¼ˆæ¸…ç†å®žéªŒçŽ¯å¢ƒï¼‰

```bash
umount /mnt/mylvm
lvremove /dev/myvg/mylv
vgremove myvg
pvremove /dev/sdb /dev/sdc
```

---

## âœ… å®žéªŒæ€»ç»“

* **PV â†’ VG â†’ LV** å°±æ˜¯ LVM çš„åŸºæœ¬ç»“æž„ã€‚
* LVM å¯ä»¥åŠ¨æ€æ‰©å®¹ï¼Œéžå¸¸çµæ´»ã€‚
* å¦‚æžœå†åŠ å¿«ç…§ï¼ˆ`lvcreate -s`ï¼‰ï¼Œè¿˜èƒ½åšæ•°æ®å¤‡ä»½ã€‚

---

## æ³¨æ„äº‹é¡¹
åœ¨vmwareä¸­æ·»åŠ ç£ç›˜åŽï¼Œè®°å¾—è¦æ‰«æä¸‹ï¼Œå¦åˆ™lsblkæ— æ³•æ˜¾ç¤ºç£ç›˜
```bash
# æŸ¥çœ‹æ‰€æœ‰SCSIä¸»æœºæ€»çº¿
ls /sys/class/scsi_host/

# å¯¹æ¯ä¸ªhostæ‰§è¡Œæ‰«æ(ä¾‹å¦‚host0, host1, host2)
echo "- - -" > /sys/class/scsi_host/host0/scan
echo "- - -" > /sys/class/scsi_host/host1/scan
echo "- - -" > /sys/class/scsi_host/host2/scan
```
